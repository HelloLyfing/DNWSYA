<div id="DNWSYA-OptsPanel">
  <div class="btn btn-default" id="shieldAreaUser" style="width: 101px;">
    <span class="glyphicon glyphicon-trash"></span> 屏蔽用户
  </div>

  <div type="button" class="btn btn-default" style="width: 101px; margin-top: 5px;">
    <span class="glyphicon glyphicon-trash"></span> 屏蔽网址
  </div>

  <div type="button" class="btn btn-default" id="shieldAreaMore" style="width: 101px; margin-top: 5px;">
    <span class="glyphicon glyphicon-align-left"></span> More...
  </div>

</div>

<script type="text/javascript">
var initElemsOnDrag = ( function(){
  
  var slt = {
    userLink     : 'td.subtext > a[href^="user?id="]',
    trashAreaUser: '#shieldAreaUser'
  }
  
  function user(){
    $(slt.userLink).on('dragstart', function(e){
      var userID = $(this).html();
      $(slt.trashAreaUser).data('userID', userID);
    });
  }

  return {
    user: user
  }
})();

var sendNewItemToChrome = function(type, value){
  var msg = {
    type  : 'DNWSYA:Request:GetNewShieldItem:TabPage',
    evData: {type: type, value: value}
  };
  chrome.runtime.sendMessage(msg, function(resp){
    FilterContent(resp.evData.list);
  });
};

$( function() {
  initElemsOnDrag.user();

  $('#shieldAreaUser').on('dragover', function(e){
    e.preventDefault();
    $(this).addClass('onDragOver');
  }).on('dragleave', function(e){
    var $this = $(this);
    clearTimeout( $this.data('timeoutID') );
    var tmpID = setTimeout( function(){
      $this.removeClass('onDragOver');
    }, 260);
    $this.data('timeoutID', tmpID);
  }).on('drop', function(e){
    e.preventDefault();
    var userID = $(this).data('userID');
    $(this).trigger('dragleave');
    sendNewItemToChrome(ShieldList.elemList[0], userID);
  });

  $('#shieldAreaMore').on('click', function(){
    // 打开后台选项页
    var url = PageParams.ExtHost + '/html/backEnd/optionPage.html';
    var msg = {
      type: 'DNWSYA:Request:NewTab:TabPage',
      evData: {url: url}
    };
    chrome.runtime.sendMessage(msg);
  });
});
</script>
